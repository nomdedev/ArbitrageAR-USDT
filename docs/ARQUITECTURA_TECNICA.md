# üìê Arquitectura T√©cnica - ArbitrARS

> **Versi√≥n:** 5.0.48  
> **Fecha:** 12 de octubre de 2025  
> **Autor:** Sistema de Documentaci√≥n ArbitrARS

---

## üìã √çndice

1. [Visi√≥n General](#-visi√≥n-general)
2. [Arquitectura de la Extensi√≥n](#-arquitectura-de-la-extensi√≥n)
3. [Flujo de Datos Completo](#-flujo-de-datos-completo)
4. [Componentes Principales](#-componentes-principales)
5. [APIs Externas](#-apis-externas)
6. [Sistema de C√°lculo de Arbitraje](#-sistema-de-c√°lculo-de-arbitraje)
7. [Sistema de Almacenamiento](#-sistema-de-almacenamiento)
8. [Comunicaci√≥n Entre Componentes](#-comunicaci√≥n-entre-componentes)
9. [Problemas Conocidos y Soluciones](#-problemas-conocidos-y-soluciones)

---

## üéØ Visi√≥n General

**ArbitrARS** es una extensi√≥n de navegador (Chrome/Edge/Brave) basada en **Manifest V3** que detecta oportunidades de arbitraje entre:
- **D√≥lar Oficial Argentino** (precio de compra en bancos)
- **USDT** (Tether) en exchanges locales de criptomonedas

### Concepto de Arbitraje

```
Paso 1: Comprar USD oficial en banco     ‚Üí $1.030 ARS por USD
Paso 2: Convertir USD ‚Üí USDT (1:1 aprox)
Paso 3: Vender USDT en exchange local    ‚Üí $1.150 ARS por USDT
Ganancia neta: $120 ARS por USD (‚âà11.6%)
```

---

## üèóÔ∏è Arquitectura de la Extensi√≥n

### Estructura Manifest V3

```
ArbitrARS/
‚îú‚îÄ manifest.json              # Configuraci√≥n de la extensi√≥n
‚îú‚îÄ src/
‚îÇ  ‚îú‚îÄ background/
‚îÇ  ‚îÇ  ‚îî‚îÄ main-simple.js       # Service Worker (background)
‚îÇ  ‚îú‚îÄ popup.html              # UI principal (ventana emergente)
‚îÇ  ‚îú‚îÄ popup.js                # L√≥gica del popup
‚îÇ  ‚îú‚îÄ popup.css               # Estilos del popup
‚îÇ  ‚îú‚îÄ options.html            # UI de configuraci√≥n
‚îÇ  ‚îú‚îÄ options.js              # L√≥gica de opciones
‚îÇ  ‚îî‚îÄ options.css             # Estilos de opciones
‚îî‚îÄ icons/                     # Iconos de la extensi√≥n
```

### Componentes Clave

| Componente | Tipo | Funci√≥n |
|------------|------|---------|
| `main-simple.js` | Service Worker | Obtiene datos de APIs, calcula rutas, mantiene estado |
| `popup.js` | Frontend | Renderiza UI, interact√∫a con usuario |
| `options.js` | Frontend | Gestiona configuraci√≥n del usuario |
| `chrome.storage.local` | Storage API | Persiste configuraci√≥n entre sesiones |

---

## üîÑ Flujo de Datos Completo

### 1. Inicio de la Extensi√≥n

```mermaid
graph TD
    A[Usuario instala extensi√≥n] --> B[Chrome carga manifest.json]
    B --> C[Inicia Service Worker: main-simple.js]
    C --> D[Service Worker queda en espera]
```

**C√≥digo en `main-simple.js`:**

```javascript
// L√≠nea 7: Service worker se inicia
console.log('üîß [BACKGROUND] Iniciando service worker...');

// L√≠nea 173-177: Estado global inicial
let currentData = null;
let lastUpdate = null;
```

### 2. Usuario Abre el Popup

```mermaid
graph TD
    A[Usuario hace clic en icono] --> B[Chrome abre popup.html]
    B --> C[Carga popup.js]
    C --> D[popup.js ejecuta fetchAndDisplay]
    D --> E[Env√≠a mensaje al Service Worker]
    E --> F[Service Worker responde con datos]
    F --> G[popup.js renderiza rutas]
```

**C√≥digo en `popup.js`:**

```javascript
// L√≠nea 410: Evento DOMContentLoaded
document.addEventListener('DOMContentLoaded', async () => {
  console.log('üöÄ Popup.js cargado correctamente');
  await loadUserSettings();
  await fetchAndDisplay();
  // ... m√°s inicializaciones
});

// L√≠nea 452: Funci√≥n principal
async function fetchAndDisplay(forceUpdate = false, retryCount = 0) {
  // 1. Mostrar loading
  loading.style.display = 'flex';
  
  // 2. Enviar mensaje al background
  chrome.runtime.sendMessage(
    { action: 'getData', forceUpdate },
    (response) => {
      // 3. Recibir datos y renderizar
      handleSuccessfulData(response, container);
    }
  );
}
```

### 3. Service Worker Obtiene Datos

```mermaid
graph TD
    A[Recibe mensaje 'getData'] --> B{Tiene datos<br/>cacheados?}
    B -->|S√≠ y frescos| C[Devuelve cache]
    B -->|No o stale| D[Llama updateData]
    D --> E[Fetch APIs en paralelo]
    E --> F[fetchDolarOficial]
    E --> G[fetchUSDT]
    E --> H[fetchUSDTtoUSD]
    F --> I[Calcula rutas]
    G --> I
    H --> I
    I --> J[Guarda en currentData]
    J --> K[Devuelve al popup]
```

**C√≥digo en `main-simple.js`:**

```javascript
// L√≠nea 234-265: Listener de mensajes
chrome.runtime.onMessage.addListener((message, sender, sendResponse) => {
  if (message.action === 'getData') {
    const forceUpdate = message.forceUpdate;
    
    // Si no hay datos o fuerza actualizaci√≥n
    if (!currentData || forceUpdate) {
      updateData().then(data => {
        sendResponse(data || currentData);
      });
      return true; // Mantiene canal abierto para async
    } else {
      // Devuelve cache
      sendResponse({
        ...currentData,
        usingCache: true
      });
      return false; // Respuesta s√≠ncrona
    }
  }
});

// L√≠nea 181-226: Funci√≥n updateData
async function updateData() {
  // 1. Fetch todas las APIs en paralelo
  const [oficial, usdt, usdtUsd] = await Promise.all([
    fetchDolarOficial(),
    fetchUSDT(),
    fetchUSDTtoUSD()
  ]);
  
  // 2. Validar datos
  if (!oficial || !usdt) {
    log('‚ùå Faltan datos b√°sicos');
    return null;
  }
  
  // 3. Calcular rutas (ASYNC!)
  const optimizedRoutes = await calculateSimpleRoutes(oficial, usdt, usdtUsd);
  
  // 4. Construir objeto de respuesta
  const data = {
    oficial,
    usdt,
    usdtUsd,
    optimizedRoutes,
    arbitrages: optimizedRoutes,
    lastUpdate: Date.now(),
    error: null,
    usingCache: false
  };
  
  // 5. Guardar en memoria
  currentData = data;
  lastUpdate = data.lastUpdate;
  
  return data;
}
```

---

## üß© Componentes Principales

### 1. Service Worker (`main-simple.js`)

**Responsabilidades:**
- ‚úÖ Obtener datos de APIs externas
- ‚úÖ Calcular todas las rutas de arbitraje
- ‚úÖ Cachear datos en memoria
- ‚úÖ Responder a mensajes del frontend
- ‚úÖ Ejecutar actualizaciones autom√°ticas

**Funciones Clave:**

| Funci√≥n | L√≠nea | Prop√≥sito |
|---------|-------|-----------|
| `fetchWithRateLimit()` | 22-42 | Rate limiting para evitar baneos |
| `fetchDolarOficial()` | 44-56 | Obtiene precio USD oficial |
| `fetchUSDT()` | 58-60 | Obtiene precios USDT/ARS |
| `fetchUSDTtoUSD()` | 62-64 | Obtiene cotizaci√≥n USDT/USD |
| `calculateSimpleRoutes()` | 73-168 | Calcula todas las rutas |
| `updateData()` | 181-226 | Orquesta actualizaci√≥n completa |

**Estado Global:**

```javascript
let currentData = null;  // Datos actuales
let lastUpdate = null;   // Timestamp √∫ltima actualizaci√≥n
```

### 2. Frontend Popup (`popup.js`)

**Responsabilidades:**
- ‚úÖ Renderizar UI de rutas
- ‚úÖ Aplicar filtros del usuario
- ‚úÖ Mostrar detalles de cada ruta
- ‚úÖ Gestionar simulaciones
- ‚úÖ Abrir configuraci√≥n

**Funciones Clave:**

| Funci√≥n | L√≠nea | Prop√≥sito |
|---------|-------|-----------|
| `fetchAndDisplay()` | 452-620 | Obtiene y muestra datos |
| `displayArbitrages()` | 1047-1175 | Renderiza lista de rutas |
| `showRouteDetails()` | 1229-1498 | Modal con detalles completos |
| `applyUserPreferences()` | 625-650 | Filtra seg√∫n configuraci√≥n |
| `loadUserSettings()` | 268-293 | Carga config desde storage |

**Estado Global:**

```javascript
let currentData = null;        // Datos del background
let selectedArbitrage = null;  // Ruta seleccionada
let userSettings = null;       // Configuraci√≥n del usuario
let currentFilter = 'no-p2p';  // Filtro activo
let allRoutes = [];            // Cache de rutas sin filtrar
```

### 3. Configuraci√≥n (`options.js`)

**Responsabilidades:**
- ‚úÖ Cargar configuraci√≥n guardada
- ‚úÖ Guardar cambios del usuario
- ‚úÖ Validar inputs
- ‚úÖ Mostrar/ocultar secciones seg√∫n opciones

**Estructura de Configuraci√≥n:**

```javascript
const DEFAULT_SETTINGS = {
  // Notificaciones
  notificationsEnabled: true,
  alertType: 'all',
  customThreshold: 5,
  soundEnabled: true,
  
  // Rutas
  showNegativeRoutes: true,
  preferSingleExchange: false,
  defaultSimAmount: 1000000,
  maxRoutesDisplay: 20,
  profitThreshold: 1.0,
  
  // Fees personalizados
  extraTradingFee: 0,
  extraWithdrawalFee: 0,
  extraTransferFee: 0,
  bankCommissionFee: 0,
  
  // Configuraci√≥n del d√≥lar
  dollarPriceSource: 'auto',  // 'auto' | 'manual'
  manualDollarPrice: 950,
  preferredBank: 'mediana',   // 'mediana' | 'promedio' | 'nacion' | etc.
  
  // Bancos
  showBestBankPrice: false,
  selectedBanks: []
};
```

---

## üåê APIs Externas

### 1. DolarAPI - D√≥lar Oficial

**Endpoint:**
```
GET https://dolarapi.com/v1/dolares/oficial
```

**Respuesta:**
```json
{
  "moneda": "USD",
  "casa": "oficial",
  "nombre": "Oficial",
  "compra": 1030.5,
  "venta": 1070.5,
  "fechaActualizacion": "2025-10-12T14:30:00.000Z"
}
```

**C√≥digo (`main-simple.js` l√≠nea 44-56):**
```javascript
async function fetchDolarOficial() {
  const data = await fetchWithRateLimit('https://dolarapi.com/v1/dolares/oficial');
  if (data && typeof data.compra === 'number' && typeof data.venta === 'number') {
    return {
      ...data,
      source: 'dolarapi_oficial',
      timestamp: Date.now()
    };
  }
  return null;
}
```

### 2. CriptoYa - Precios USDT/ARS

**Endpoint:**
```
GET https://criptoya.com/api/usdt/ars/1
```

**Respuesta:**
```json
{
  "binance": {
    "ask": 1150.25,
    "totalAsk": 1150.25,
    "bid": 1145.50,
    "totalBid": 1145.50,
    "time": 1728745800
  },
  "buenbit": {
    "ask": 1152.00,
    "bid": 1148.00,
    "time": 1728745800
  },
  // ... m√°s exchanges
}
```

**C√≥digo (`main-simple.js` l√≠nea 58-60):**
```javascript
async function fetchUSDT() {
  return await fetchWithRateLimit('https://criptoya.com/api/usdt/ars/1');
}
```

### 3. CriptoYa - Cotizaci√≥n USDT/USD

**Endpoint:**
```
GET https://criptoya.com/api/usdt/usd/1
```

**Respuesta:** Similar a USDT/ARS pero en d√≥lares

**Uso:** Detectar paridades rotas o problemas de liquidez

---

## üßÆ Sistema de C√°lculo de Arbitraje

### Funci√≥n `calculateSimpleRoutes()`

**Ubicaci√≥n:** `main-simple.js` l√≠neas 73-168

**Entradas:**
- `oficial`: Objeto con precio oficial del d√≥lar
- `usdt`: Objeto con precios USDT/ARS de todos los exchanges
- `usdtUsd`: Objeto con precios USDT/USD

**Proceso Paso a Paso:**

#### 1. Obtener Configuraci√≥n del Usuario

```javascript
// L√≠nea 86-93
const result = await chrome.storage.local.get('notificationSettings');
const userSettings = result.notificationSettings || {};
initialAmount = userSettings.defaultSimAmount || 1000000;
```

#### 2. Por Cada Exchange, Calcular Ganancia

```javascript
// L√≠nea 100-167: Loop por cada exchange
for (const [exchangeName, data] of Object.entries(usdt)) {
  processedCount++;
  
  // VALIDACI√ìN: Saltar si no tiene precio de venta
  if (!data?.bid || typeof data.bid !== 'number' || data.bid <= 0) {
    skippedCount++;
    continue;
  }
  
  // PASO 1: Comprar USD oficial
  const officialPrice = oficial.compra;  // Ej: $1030
  const usdAmount = initialAmount / officialPrice;  // Ej: $1M / 1030 = 970.87 USD
  
  // PASO 2: Convertir USD ‚Üí USDT (paridad 1:1)
  const usdtAmount = usdAmount;  // 970.87 USDT
  
  // PASO 3: Vender USDT en exchange por ARS
  const sellPrice = data.bid;  // Ej: $1150 (precio de compra del exchange)
  const finalARS = usdtAmount * sellPrice;  // 970.87 * 1150 = $1,116,500.50
  
  // PASO 4: Calcular ganancia bruta
  const profit = finalARS - initialAmount;  // $1,116,500.50 - $1,000,000 = $116,500.50
  const profitPercent = (profit / initialAmount) * 100;  // 11.65%
  
  // PASO 5: Aplicar fees estimados
  const fees = estimateFees(exchangeName, usdtAmount, userSettings);
  const netProfit = profit - fees;
  const netPercent = (netProfit / initialAmount) * 100;
  
  // PASO 6: Crear objeto de ruta
  routes.push({
    exchange: exchangeName,
    buyExchange: 'Banco (USD oficial)',
    sellExchange: exchangeName,
    initialAmount,
    officialPrice,
    usdAmount,
    usdtAmount,
    sellPrice,
    finalAmount: finalARS,
    profit,
    profitPercent,
    fees,
    netProfit,
    netPercent,
    risk: calculateRisk(exchangeName, profitPercent),
    timestamp: Date.now()
  });
}
```

#### 3. Ordenar Rutas por Ganancia

```javascript
// L√≠nea 164: Ordenar descendente por ganancia neta
routes.sort((a, b) => b.netPercent - a.netPercent);

// L√≠nea 168: Limitar a 50 mejores
return routes.slice(0, 50);
```

### Estimaci√≥n de Fees

**Fees Considerados:**
1. **Trading Fee:** Comisi√≥n del exchange (0.1% - 1%)
2. **Withdrawal Fee:** Costo de retiro de USDT
3. **Transfer Fee:** Costo de transferencia bancaria
4. **Bank Commission:** Comisi√≥n del banco por compra USD

**C√≥digo (conceptual):**
```javascript
function estimateFees(exchange, usdtAmount, settings) {
  const tradingFee = usdtAmount * 0.001; // 0.1% default
  const withdrawalFee = settings.extraWithdrawalFee || 0;
  const transferFee = settings.extraTransferFee || 0;
  const bankFee = settings.bankCommissionFee || 0;
  
  return tradingFee + withdrawalFee + transferFee + bankFee;
}
```

### C√°lculo de Riesgo

**Factores:**
- üü¢ **Bajo:** Exchanges tier-1 (Binance, Buenbit)
- üü° **Medio:** Exchanges medianos con historial
- üî¥ **Alto:** Exchanges peque√±os o P2P

---

## üíæ Sistema de Almacenamiento

### Chrome Storage Local

**API Usada:** `chrome.storage.local`

**Datos Almacenados:**

```javascript
// Estructura completa en storage
{
  "notificationSettings": {
    // Todas las configuraciones del usuario
    notificationsEnabled: true,
    alertType: 'all',
    dollarPriceSource: 'auto',
    manualDollarPrice: 950,
    preferredBank: 'mediana',
    // ... m√°s configuraciones
  }
}
```

**Operaciones:**

#### Lectura
```javascript
const result = await chrome.storage.local.get('notificationSettings');
const settings = result.notificationSettings || DEFAULT_SETTINGS;
```

#### Escritura
```javascript
await chrome.storage.local.set({ 
  notificationSettings: newSettings 
});
```

#### Escucha de Cambios
```javascript
chrome.storage.onChanged.addListener((changes, namespace) => {
  if (namespace === 'local' && changes.notificationSettings) {
    const oldSettings = changes.notificationSettings.oldValue;
    const newSettings = changes.notificationSettings.newValue;
    
    // Reaccionar a cambios
    if (oldSettings.manualDollarPrice !== newSettings.manualDollarPrice) {
      console.log('Precio manual cambi√≥, recalcular...');
      updateData();
    }
  }
});
```

---

## üì° Comunicaci√≥n Entre Componentes

### Modelo de Mensajer√≠a

**Chrome Extensions Manifest V3 usa:**
- `chrome.runtime.sendMessage()` - Frontend ‚Üí Background
- `chrome.runtime.onMessage.addListener()` - Background escucha

### Flujo Completo

```mermaid
sequenceDiagram
    participant P as popup.js
    participant BG as main-simple.js
    participant API as APIs Externas
    participant S as Chrome Storage
    
    P->>BG: sendMessage({action: 'getData'})
    BG->>S: Leer configuraci√≥n
    S-->>BG: notificationSettings
    BG->>API: fetchDolarOficial()
    BG->>API: fetchUSDT()
    BG->>API: fetchUSDTtoUSD()
    API-->>BG: Datos JSON
    BG->>BG: calculateSimpleRoutes()
    BG-->>P: sendResponse(data)
    P->>P: displayArbitrages(data)
```

### Tipos de Mensajes

#### 1. `getData` - Obtener Datos

**Request:**
```javascript
chrome.runtime.sendMessage(
  { 
    action: 'getData', 
    forceUpdate: false 
  },
  (response) => {
    console.log(response.optimizedRoutes);
  }
);
```

**Response:**
```javascript
{
  oficial: { compra: 1030, venta: 1070, ... },
  usdt: { binance: {...}, buenbit: {...}, ... },
  usdtUsd: { binance: {...}, ... },
  optimizedRoutes: [ 32 rutas ordenadas ],
  arbitrages: [ mismo que optimizedRoutes ],
  lastUpdate: 1728745800000,
  error: null,
  usingCache: false
}
```

#### 2. `getBankRates` - Obtener Precios Bancarios

**Estado:** ‚ùå NO IMPLEMENTADO en `main-simple.js`

**Soluci√≥n Temporal:** Mostrar mensaje informativo

---

## üêõ Problemas Conocidos y Soluciones

### 1. ‚ùå Configuraci√≥n de D√≥lar Manual No Se Aplica

**Problema:**
El usuario configura un precio manual en `options.html`, pero el background **siempre** usa DolarAPI.

**Causa Ra√≠z:**
`updateData()` siempre llama `fetchDolarOficial()` sin verificar `dollarPriceSource`.

**Ubicaci√≥n del Bug:**
`main-simple.js` l√≠nea 185-190

**C√≥digo Actual (Buggy):**
```javascript
const [oficial, usdt, usdtUsd] = await Promise.all([
  fetchDolarOficial(),  // ‚ùå SIEMPRE llama API
  fetchUSDT(),
  fetchUSDTtoUSD()
]);
```

**Soluci√≥n Requerida:**
```javascript
// 1. Leer configuraci√≥n ANTES de fetch
const settingsResult = await chrome.storage.local.get('notificationSettings');
const userSettings = settingsResult.notificationSettings || {};

// 2. Decidir fuente del precio
let oficial;
if (userSettings.dollarPriceSource === 'manual') {
  // Usar precio manual
  oficial = {
    compra: userSettings.manualDollarPrice || 950,
    venta: userSettings.manualDollarPrice || 950,
    source: 'manual',
    timestamp: Date.now()
  };
} else {
  // Usar API
  oficial = await fetchDolarOficial();
}

// 3. Continuar con resto de fetches
const [usdt, usdtUsd] = await Promise.all([
  fetchUSDT(),
  fetchUSDTtoUSD()
]);
```

### 2. ‚ùå Bot√≥n "Recalcular" No Funciona

**Problema:**
El bot√≥n pide un precio pero no recalcula con ese valor.

**Causa:**
La funcionalidad requiere implementaci√≥n modular que no existe en `main-simple.js`.

**Soluci√≥n Temporal:**
Mostrar mensaje informativo y redirigir a configuraci√≥n.

**C√≥digo Actual (`popup.js` l√≠nea 1886-1910):**
```javascript
async function showRecalculateDialog() {
  const currentPrice = currentData?.oficial?.compra || 1000;
  
  const customPrice = prompt(
    'üíµ Ingresa el precio del d√≥lar para referencia:\n\n' +
    `Precio actual: $${currentPrice.toFixed(2)}\n\n` +
    'Nota: El rec√°lculo usa el precio configurado en opciones.',
    currentPrice.toFixed(2)
  );

  if (customPrice && !isNaN(customPrice) && parseFloat(customPrice) > 0) {
    const price = parseFloat(customPrice);
    
    // ‚ùå NO recalcula realmente
    alert(`üí° Precio de referencia: $${price.toFixed(2)}\n\nPara cambiar el precio del d√≥lar, usa el bot√≥n ‚öôÔ∏è Configuraci√≥n.`);
    
    // Solo refresca
    fetchAndDisplay();
  }
}
```

### 3. ‚úÖ Rutas No Se Mostraban (Resuelto v5.0.47)

**Problema:**
Background calculaba 32 rutas pero popup recib√≠a 0.

**Causa:**
`calculateSimpleRoutes()` es async pero se llamaba sin `await`.

**Fix Aplicado:**
```javascript
// ANTES (buggy):
const optimizedRoutes = calculateSimpleRoutes(oficial, usdt, usdtUsd);
// optimizedRoutes era una Promise, no un Array

// DESPU√âS (correcto):
const optimizedRoutes = await calculateSimpleRoutes(oficial, usdt, usdtUsd);
// optimizedRoutes es un Array con 32 rutas
```

### 4. üîÑ Storage Changes No Disparan Rec√°lculo

**Problema:**
Cambiar configuraci√≥n en `options.html` no actualiza datos en popup abierto.

**Soluci√≥n Requerida:**
Implementar listener en `main-simple.js`:

```javascript
chrome.storage.onChanged.addListener((changes, namespace) => {
  if (namespace === 'local' && changes.notificationSettings) {
    const newSettings = changes.notificationSettings.newValue;
    const oldSettings = changes.notificationSettings.oldValue;
    
    // Detectar cambios cr√≠ticos
    if (
      newSettings.dollarPriceSource !== oldSettings.dollarPriceSource ||
      newSettings.manualDollarPrice !== oldSettings.manualDollarPrice ||
      newSettings.preferredBank !== oldSettings.preferredBank
    ) {
      console.log('‚öôÔ∏è Configuraci√≥n cambi√≥, actualizando datos...');
      updateData(); // Forzar rec√°lculo
    }
  }
});
```

---

## üìä Diagrama de Arquitectura Final

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        USUARIO                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
                           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    CHROME BROWSER                             ‚îÇ
‚îÇ                                                               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  popup.html    ‚îÇ  ‚îÇ options.html   ‚îÇ  ‚îÇ  Service     ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  popup.js      ‚îÇ‚óÑ‚îÄ‚î§ options.js     ‚îÇ  ‚îÇ  Worker      ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  popup.css     ‚îÇ  ‚îÇ options.css    ‚îÇ  ‚îÇ  (BG)        ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ         ‚îÇ                    ‚îÇ                    ‚îÇ          ‚îÇ
‚îÇ         ‚ñº                    ‚ñº                    ‚ñº          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ        chrome.runtime & chrome.storage API          ‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îÇ                           ‚îÇ                                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
                            ‚ñº
               ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
               ‚îÇ   chrome.storage.local ‚îÇ
               ‚îÇ   (Persist Config)     ‚îÇ
               ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
                            ‚ñº
               ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
               ‚îÇ    EXTERNAL APIs       ‚îÇ
               ‚îÇ                        ‚îÇ
               ‚îÇ  ‚Ä¢ DolarAPI            ‚îÇ
               ‚îÇ  ‚Ä¢ CriptoYa USDT/ARS   ‚îÇ
               ‚îÇ  ‚Ä¢ CriptoYa USDT/USD   ‚îÇ
               ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üéì Conclusiones

### Fortalezas del Dise√±o
‚úÖ Arquitectura clara con separaci√≥n de responsabilidades  
‚úÖ Caching eficiente en service worker  
‚úÖ Rate limiting para evitar baneos de API  
‚úÖ Configuraci√≥n persistente del usuario  
‚úÖ UI responsive y clara  

### √Åreas de Mejora
üîß Implementar respeto a configuraci√≥n manual del d√≥lar  
üîß Agregar listener de cambios en storage  
üîß Implementar funcionalidad real de "recalcular"  
üîß Agregar manejo de errores m√°s robusto  
üîß Implementar notificaciones push cuando aparezcan rutas rentables  

---

**Documento generado por:** ArbitrARS Documentation System  
**√öltima actualizaci√≥n:** 12 de octubre de 2025  
**Versi√≥n de la extensi√≥n:** 5.0.48
