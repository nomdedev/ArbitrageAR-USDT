<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>arbitrarARS</title>
    <link rel="stylesheet" href="popup.css" />
  </head>
  <body>
    <div class="container">
      <header>
        <div class="header-content">
          <h1>
            <span class="logo-icon">üí∞</span>
            arbitrarARS
          </h1>
          <p class="subtitle">D√≥lar Oficial ‚Üí USDT</p>
          <div id="dataStatus" class="data-status"></div>
        </div>
        <div class="header-buttons">
          <span id="version-indicator" class="version-indicator" title="Versi√≥n instalada">
            v5.0.80
          </span>
          <button id="settings" class="btn-settings" title="Configurar notificaciones">
            <span>‚öôÔ∏è</span>
          </button>
          <button id="refresh" class="btn-refresh" title="Actualizar datos">
            <span class="refresh-icon">‚ü≥</span>
          </button>
        </div>
      </header>

      <!-- Banner de Actualizaci√≥n Disponible -->
      <div id="update-banner" class="update-banner" role="alert" aria-live="polite">
        <span class="update-type-badge" id="update-type">MAJOR</span>
        
        <div class="update-content">
          <span class="update-icon">‚ú®</span>
          <div class="update-text">
            <strong>Nueva actualizaci√≥n disponible</strong>
            <p class="update-version-info">
              <span class="current-version" id="current-version">v5.0.83</span>
              <span class="version-arrow">‚Üí</span>
              <span class="new-version" id="new-version">v6.0.0</span>
            </p>
            <p id="update-message" class="update-commit-msg">
              Nueva versi√≥n con mejoras
            </p>
          </div>
        </div>
        
        <div class="update-actions">
          <button id="view-update" class="btn-view-update">
            Ver cambios
          </button>
          <button id="dismiss-update" class="btn-dismiss-update"
                  aria-label="Cerrar notificaci√≥n de actualizaci√≥n">
            ‚úï
          </button>
        </div>
      </div>

      <!-- Indicador de Salud del Mercado -->
      <div id="marketHealth" class="market-health"></div>

      <!-- Indicador de Cache -->
      <div id="cache-indicator" class="cache-indicator" style="display: none"></div>

      <!-- NUEVO v5.0.74: Advertencias de datos -->
      <div id="data-warning" class="data-warning-container" style="display: none"></div>

      <!-- Informaci√≥n del Precio del D√≥lar -->
      <div id="dollar-info" class="dollar-info" style="display: none">
        <div class="dollar-info-content">
          <div class="dollar-price">
            <span class="dollar-icon">üíµ</span>
            <div class="dollar-details">
              <span class="dollar-value" id="dollar-current-price">$950.00</span>
              <span class="dollar-source" id="dollar-source-text">Fuente: Manual</span>
            </div>
          </div>
        </div>
      </div>

      <div class="tabs">
        <button class="tab active" data-tab="routes">üíµ Arbitraje Fiat</button>
        <button class="tab" data-tab="crypto-arbitrage">üîÑ Arbitraje Cripto</button>
        <button class="tab" data-tab="simulator">üßÆ Simulador</button>
        <button class="tab" data-tab="banks">üè¶ Exchanges</button>
        <button class="tab" data-tab="guide" style="display: none">üìã Gu√≠a</button>
      </div>

      <main>
        <!-- TAB: Gu√≠a Paso a Paso -->
        <section id="tab-guide" class="tab-content">
          <div id="selected-arbitrage-guide">
            <div class="placeholder-guide">
              <p>Selecciona una oportunidad de arbitraje para ver los pasos detallados.</p>
            </div>
          </div>
        </section>

        <!-- TAB: Todas las Rutas (Single + Multi-Exchange) -->
        <section id="tab-routes" class="tab-content active">
          <!-- Controles de filtro -->
          <div class="filter-controls">
            <div class="filter-section">
              <div class="filter-buttons">
                <button
                  class="filter-btn active"
                  data-filter="no-p2p"
                  title="Mostrar solo rutas directas (sin P2P)"
                >
                  <span class="btn-icon">‚ö°</span>
                  <span class="btn-count" id="count-no-p2p">0</span>
                </button>
                <button
                  class="filter-btn"
                  data-filter="p2p"
                  title="Mostrar solo rutas P2P (persona a persona)"
                >
                  <span class="btn-icon">ü§ù</span>
                  <span class="btn-count" id="count-p2p">0</span>
                </button>
                <button
                  class="filter-btn"
                  data-filter="all"
                  title="Mostrar todas las rutas disponibles"
                >
                  <span class="btn-icon">üéØ</span>
                  <span class="btn-count" id="count-all">0</span>
                </button>
              </div>
            </div>
          </div>

          <div id="loading" class="loading skeleton-container">
            <div class="skeleton skeleton-card"></div>
            <div class="skeleton skeleton-card"></div>
            <div class="skeleton skeleton-card"></div>
            <p class="loading-text">Calculando rutas optimizadas...</p>
          </div>
          <div id="optimized-routes"></div>
        </section>

        <!-- TAB: Arbitraje Cripto (NUEVO) -->
        <section id="tab-crypto-arbitrage" class="tab-content">
          <!-- Selector de Criptomoneda -->
          <div class="crypto-selector">
            <label for="crypto-filter">Filtrar por cripto:</label>
            <select id="crypto-filter" class="crypto-dropdown">
              <option value="all">Todas las criptos</option>
              <option value="BTC">Bitcoin (BTC)</option>
              <option value="ETH">Ethereum (ETH)</option>
              <option value="USDC">USD Coin (USDC)</option>
              <option value="DAI">DAI</option>
              <option value="BNB">Binance Coin (BNB)</option>
              <option value="SOL">Solana (SOL)</option>
              <option value="ADA">Cardano (ADA)</option>
              <option value="XRP">Ripple (XRP)</option>
              <option value="MATIC">Polygon (MATIC)</option>
              <option value="DOGE">Dogecoin (DOGE)</option>
              <option value="USDT">Tether (USDT)</option>
            </select>
          </div>

          <!-- Filtros de Operaci√≥n -->
          <div class="filter-controls">
            <div class="filter-buttons">
              <button
                class="filter-btn-operation active"
                data-filter="all"
                title="Mostrar todas las operaciones"
              >
                <span>üéØ Todas</span>
              </button>
              <button
                class="filter-btn-operation"
                data-filter="direct"
                title="Solo operaciones directas (sin P2P)"
              >
                <span>‚ö° Direct</span>
              </button>
              <button class="filter-btn-operation" data-filter="p2p" title="Solo operaciones P2P">
                <span>ü§ù P2P</span>
              </button>
            </div>
          </div>

          <!-- Contenedor de Rutas Crypto -->
          <div id="crypto-routes-container">
            <div class="loading skeleton-container">
              <div class="skeleton skeleton-card"></div>
              <div class="skeleton skeleton-card"></div>
              <p class="loading-text">Calculando oportunidades de arbitraje crypto...</p>
            </div>
          </div>
        </section>

        <!-- TAB: Simulador con Monto Personalizado -->
        <section id="tab-simulator" class="tab-content">
          <div class="simulator-container">
            <div class="simulator-header">
              <h3>Calculadora de Arbitraje</h3>
              <p>Configura los par√°metros y analiza la matriz de rendimientos</p>
            </div>

            <div class="simulator-input">
              <label for="sim-amount">Monto de referencia (ARS):</label>
              <input
                type="number"
                id="sim-amount"
                class="input-base"
                value="1000000"
                min="1000"
                max="10000000"
                step="1000"
              />
            </div>

            <!-- Configuraci√≥n de Par√°metros -->
            <div class="simulator-advanced-toggle">
              <button id="toggle-advanced" class="btn-toggle-advanced">
                ‚öôÔ∏è Par√°metros de C√°lculo
              </button>
            </div>

            <div id="advanced-config" class="advanced-config" style="display: none">
              <div class="config-section">
                <h4>üíµ Precios del D√≥lar</h4>
                <div class="config-row">
                  <div class="config-input">
                    <label for="sim-usd-buy-price">Precio compra USD (ARS):</label>
                    <input
                      type="number"
                      id="sim-usd-buy-price"
                      class="input-base"
                      step="0.01"
                      placeholder="950.00"
                    />
                  </div>
                  <div class="config-input">
                    <label for="sim-usd-sell-price">Precio venta USD (ARS):</label>
                    <input
                      type="number"
                      id="sim-usd-sell-price"
                      class="input-base"
                      step="0.01"
                      placeholder="970.00"
                    />
                  </div>
                </div>
              </div>

              <div class="config-section">
                <h4>üí∞ Fees y Comisiones</h4>
                <div class="config-row">
                  <div class="config-input">
                    <label for="sim-buy-fee">Fee compra USDT (%):</label>
                    <input
                      type="number"
                      id="sim-buy-fee"
                      class="input-base"
                      step="0.01"
                      value="1.0"
                      min="0"
                      max="10"
                    />
                  </div>
                  <div class="config-input">
                    <label for="sim-sell-fee">Fee venta USDT (%):</label>
                    <input
                      type="number"
                      id="sim-sell-fee"
                      class="input-base"
                      step="0.01"
                      value="1.0"
                      min="0"
                      max="10"
                    />
                  </div>
                </div>
                <div class="config-row">
                  <div class="config-input">
                    <label for="sim-transfer-fee-usd">Fee transferencia (USD):</label>
                    <input
                      type="number"
                      id="sim-transfer-fee-usd"
                      class="input-base"
                      step="0.01"
                      value="0"
                      min="0"
                    />
                  </div>
                  <div class="config-input">
                    <label for="sim-bank-commission">Comisi√≥n bancaria (%):</label>
                    <input
                      type="number"
                      id="sim-bank-commission"
                      class="input-base"
                      step="0.01"
                      value="0"
                      min="0"
                      max="5"
                    />
                  </div>
                </div>
              </div>

              <div class="config-section">
                <h4>üìä Matriz de Rendimientos</h4>
                <div class="config-row">
                  <div class="config-input">
                    <label for="matrix-min-percent">Rendimiento m√≠nimo (%):</label>
                    <input
                      type="number"
                      id="matrix-min-percent"
                      step="0.1"
                      value="0"
                      min="-5"
                      max="5"
                    />
                  </div>
                  <div class="config-input">
                    <label for="matrix-max-percent">Rendimiento m√°ximo (%):</label>
                    <input
                      type="number"
                      id="matrix-max-percent"
                      step="0.1"
                      value="2"
                      min="-5"
                      max="10"
                    />
                  </div>
                  <div class="config-input">
                    <label for="matrix-step-percent">Paso (%):</label>
                    <input
                      type="number"
                      id="matrix-step-percent"
                      step="0.1"
                      value="0.5"
                      min="0.1"
                      max="2"
                    />
                  </div>
                </div>
              </div>

              <div class="config-actions">
                <button id="btn-calculate-matrix" class="btn-calculate-matrix">
                  üìä Calcular Matriz
                </button>
                <button id="btn-reset-config" class="btn-reset-config">üîÑ Reset</button>
              </div>
            </div>

            <!-- Secci√≥n: Matriz de Riesgo/Rendimiento -->
            <div class="risk-matrix-section">
              <h3>üìä Matriz de An√°lisis de Rentabilidad</h3>
              <p>Visualiza la ganancia seg√∫n diferentes escenarios de precios USD/USDT</p>

              <div class="matrix-controls">
                <div class="matrix-control-item">
                  <label for="matrix-usd-min">USD M√≠nimo (ARS):</label>
                  <input
                    type="number"
                    id="matrix-usd-min"
                    step="10"
                    value="1400"
                    min="800"
                    max="2000"
                    placeholder="Auto"
                  />
                </div>
                <div class="matrix-control-item">
                  <label for="matrix-usd-max">USD M√°ximo (ARS):</label>
                  <input
                    type="number"
                    id="matrix-usd-max"
                    step="10"
                    value="2100"
                    min="800"
                    max="2500"
                    placeholder="Auto"
                  />
                </div>
                <div class="matrix-control-item">
                  <label for="matrix-usdt-min">USDT M√≠nimo (ARS):</label>
                  <input
                    type="number"
                    id="matrix-usdt-min"
                    step="10"
                    value="1000"
                    min="900"
                    max="1300"
                    placeholder="Auto"
                  />
                </div>
                <div class="matrix-control-item">
                  <label for="matrix-usdt-max">USDT M√°ximo (ARS):</label>
                  <input
                    type="number"
                    id="matrix-usdt-max"
                    step="10"
                    value="1100"
                    min="900"
                    max="1300"
                    placeholder="Auto"
                  />
                </div>
                <button id="generate-risk-matrix" class="matrix-generate-btn">
                  ÔøΩ Regenerar con Par√°metros
                </button>
              </div>

              <div id="risk-matrix-result" style="display: none">
                <!-- Filtros visuales -->
                <div class="matrix-filters">
                  <h4>üéØ Filtros de Rentabilidad</h4>
                  <div class="filter-controls-matrix">
                    <div class="filter-item">
                      <label for="filter-min-profit">Ganancia m√≠nima (%):</label>
                      <input
                        type="number"
                        id="filter-min-profit"
                        step="0.5"
                        value="-5"
                        min="-10"
                        max="10"
                      />
                    </div>
                    <div class="filter-item">
                      <label for="filter-max-profit">Ganancia m√°xima (%):</label>
                      <input
                        type="number"
                        id="filter-max-profit"
                        step="0.5"
                        value="10"
                        min="-10"
                        max="20"
                      />
                    </div>
                    <button id="apply-matrix-filter" class="btn-apply-filter">
                      Aplicar Filtro
                    </button>
                    <button id="reset-matrix-filter" class="btn-reset-filter">Resetear</button>
                  </div>
                  <div class="filter-results" id="filter-results" style="display: none">
                    <span id="filter-count">0</span>
                    combinaciones visibles
                  </div>
                </div>

                <div class="matrix-table-container">
                  <table class="risk-matrix-table" id="risk-matrix-table">
                    <!-- Contenido generado din√°micamente -->
                  </table>
                </div>

                <div class="matrix-legend">
                  <div class="legend-item">
                    <div class="legend-color positive"></div>
                    <span class="legend-label">Rentable (> 1%)</span>
                  </div>
                  <div class="legend-item">
                    <div class="legend-color neutral"></div>
                    <span class="legend-label">Marginal (0% - 1%)</span>
                  </div>
                  <div class="legend-item">
                    <div class="legend-color negative"></div>
                    <span class="legend-label">P√©rdida (< 0%)</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- TAB: Bancos -->
        <section id="tab-banks" class="tab-content">
          <div id="banks-list">
            <div class="loading skeleton-container">
              <div class="skeleton skeleton-card"></div>
              <div class="skeleton skeleton-card"></div>
              <div class="skeleton skeleton-card"></div>
              <p class="loading-text">Cargando cotizaciones de exchanges...</p>
            </div>
          </div>
        </section>
      </main>

      <footer>
        <div id="last-update" class="timestamp"></div>
        <div class="footer-note">‚ö†Ô∏è Los precios son referenciales. Verificar antes de operar.</div>
      </footer>

      <!-- MODAL DE DETALLES DE RUTA - Accesibilidad mejorada v6.0.0 -->
      <div
        id="route-details-modal"
        class="modal-overlay"
        style="display: none"
        role="dialog"
        aria-modal="true"
        aria-labelledby="modal-title"
        aria-describedby="modal-body"
      >
        <div class="modal-content" role="document">
          <div class="modal-header">
            <h3 id="modal-title">Detalles de la Ruta</h3>
            <button
              id="modal-close"
              class="modal-close-btn"
              title="Cerrar (Esc)"
              aria-label="Cerrar modal"
            >
              ‚úï
            </button>
          </div>
          <div id="modal-body" class="modal-body">
            <!-- Contenido generado din√°micamente -->
          </div>
        </div>
      </div>
    </div>
    <!-- M√≥dulos Utils (cargados antes de popup.js) -->
    <script src="utils/stateManager.js"></script>
    <script src="utils/formatters.js"></script>
    <script src="utils/logger.js"></script>
    <script src="ui/routeRenderer.js"></script>
    <script src="utils.js"></script>
    <script src="renderHelpers.js"></script>
    <script src="ValidationService.js"></script>
    <script src="popup.js"></script>
  </body>
</html>
